{"version":3,"names":[],"mappings":"","sources":["main.js"],"sourcesContent":["/* eslint-disable */\n'use strict';\n\n(function() {\n  var deletEls = document.querySelectorAll('.js-delete');\n  if (deletEls.length === 0) {\n    return;\n  }\n\n  for (var i = 0; i < deletEls.length; i++) {\n    deletEls[i].addEventListener('click', function(evt) {\n      evt.target.setAttribute(`disabled`, `disabled`);\n      const card = this.closest('.js-card');\n      card.style.animation = ``;\n\n      if (evt.target.id === `ticket-delete`) {\n        const offerId = evt.target.dataset.offer;\n        fetch(`http://localhost:3000/api/offers/${offerId}`, {\n          method: `DELETE`\n        })\n          .then(() => {\n            card.parentElement.removeChild(card);\n          })\n          .catch(() => {\n            card.style.animation = `shake 0.6s`;\n            evt.target.removeAttribute(`disabled`);\n          })\n      }\n      if (evt.target.id === `comment-delete`) {\n        const offerId = evt.target.dataset.offer;\n        const commentId = evt.target.dataset.comment;\n        fetch(`http://localhost:3000/api/offers/${offerId}/comments/${commentId}`, {\n          method: `DELETE`,\n        })\n          .then(() => location.reload(true))\n          .catch(() => {\n            card.style.animation = `shake 0.6s`;\n            evt.target.removeAttribute(`disabled`);\n          })\n      }\n    })\n  }\n})();\n\n'use strict';\n\n(function () {\n  var form = document.querySelector('.form');\n\n  if (form) {\n    var formFields = form.querySelectorAll('.js-field');\n    var formButton = form.querySelector('.js-button');\n\n    var setFillField = function (field) {\n      if (field.value) {\n        field.parentNode.classList.add('form__field--fill');\n      } else {\n        field.parentNode.classList.remove('form__field--fill');\n      }\n      field.addEventListener('focus', function () {\n        field.parentNode.classList.add('form__field--focus');\n      });\n      field.addEventListener('blur', function () {\n        field.parentNode.classList.remove('form__field--focus');\n      });\n    };\n\n    var getFillFields = function () {\n      var fill = true;\n      for (var i = 0; i < formFields.length; i++) {\n        if (!formFields[i].value) {\n          fill = false;\n          break;\n        }\n      }\n      return fill;\n    };\n\n    Array.prototype.slice.call(formFields).forEach(function (field) {\n      setFillField(field);\n    });\n\n    Array.prototype.slice.call(formFields).forEach(function (field) {\n      field.addEventListener('input', function () {\n        setFillField(field);\n        if (formButton) {\n          if (getFillFields()) {\n            formButton.removeAttribute('disabled');\n          } else {\n            formButton.setAttribute('disabled', 'disabled');\n          }\n        }\n      });\n    });\n\n    var selects = document.querySelectorAll('.js-multiple-select');\n    for (var i = 0; i < selects.length; i++) {\n      var placeholder = selects[i].dataset['label'];\n      const selectrConfig = {\n        defaultSelected: false,\n        searchable: false,\n        multiple: true,\n        width: 222,\n        placeholder: placeholder,\n        data: selects[i].dataset['categories'].split(`,`)\n          .map((id, index) => ({\n            value: id,\n            text: selects[i].dataset['titles'].split(`,`)[index],\n            selected: selects[i].dataset['active'].split(`,`).includes(id)\n          })),\n        selectedValue: selects[i].dataset['active'].split(`,`)\n      };\n      const SS = new Selectr(selects[i], selectrConfig);\n    }\n\n    var priceField = form.querySelector('.js-price');\n    if (priceField) {\n      priceField.addEventListener('keydown', function(e) {\n        if (window.event.keyCode >= 65 && window.event.keyCode <= 90 || window.event.keyCode === 189 || window.event.keyCode === 188) {\n          e.preventDefault();\n        }\n        if (window.event.keyCode === 190 && (!priceField.value || priceField.value.includes('.'))) {\n          e.preventDefault();\n        }\n      })\n    }\n  }\n\n})();\n\n'use strict';\n\n(function () {\n  var signUpAvatarContainer = document.querySelector('.js-preview-container');\n\n  if (signUpAvatarContainer) {\n    var signUpFieldAvatarInput = signUpAvatarContainer.querySelector('.js-file-field');\n    var signUpAvatar = signUpAvatarContainer.querySelector('.js-preview');\n\n    var readFilePhoto = function (file) {\n      var reader = new FileReader();\n      reader.addEventListener('load', function () {\n        var image = document.createElement('img');\n        image.src = reader.result;\n        signUpAvatar.innerHTML = '';\n        signUpAvatar.appendChild(image);\n      });\n      reader.readAsDataURL(file);\n    };\n\n    signUpFieldAvatarInput.addEventListener('change', function () {\n      var file = signUpFieldAvatarInput.files[0];\n      readFilePhoto(file);\n      signUpAvatarContainer.classList.add('uploaded');\n    });\n  }\n})();\n\n'use strict';\n\n(function () {\n  svg4everybody();\n})();\n\n'use strict';\n\n(function () {\n  var search = document.querySelector('.search');\n\n  if (search) {\n    var searchInput = search.querySelector('.search input');\n    var searchCloseButton = search.querySelector('.search__close-btn');\n\n    if (searchInput.value) {\n      search.classList.add('search--active');\n      searchCloseButton.classList.add('search__close-btn--active');\n    } else {\n      search.classList.remove('search--active');\n      searchCloseButton.classList.remove('search__close-btn--active');\n    }\n\n    searchInput.addEventListener('change', function () {\n      if (searchInput.value) {\n        search.classList.add('search--active');\n      } else {\n        search.classList.remove('search--active');\n      }\n    });\n\n    searchInput.addEventListener('input', function () {\n      if (searchInput.value) {\n        searchCloseButton.classList.add('search__close-btn--active');\n      } else {\n        searchCloseButton.classList.remove('search__close-btn--active');\n      }\n    });\n\n    searchCloseButton.addEventListener('click', function () {\n      searchCloseButton.classList.remove('search__close-btn--active');\n      searchInput.value = '';\n      search.classList.remove('search--active');\n    });\n  }\n})();\n\n// create comment\n'use strict';\n\n(function () {\n  const commentForm = document.forms[`comment`];\n  if (!commentForm) {\n    return;\n  }\n\n  const textField = commentForm.querySelector(`textarea`);\n\n  commentForm.addEventListener(`submit`, (evt) => {\n    evt.preventDefault();\n    cleanForm(commentForm);\n    const offerId = commentForm.dataset.offer;\n    setFormDisabled(commentForm, true);\n\n    fetch(`http://localhost:3000/api/offers/${offerId}/comments`, {\n      method: `POST`,\n      body: JSON.stringify({text: textField.value.trim()}),\n      headers: new Headers({'Content-Type': `application/json`})\n    })\n      .then((res) => {\n        if (!res.ok) {\n          throw Error();\n        }\n      })\n      .then(() => location.reload(true))\n      .catch(() => {\n        commentForm.style.animation = `shake 0.6s`;\n        setFormDisabled(commentForm, false);\n      })\n  });\n})();\n\n// login\n'use strict';\n\n(function () {\n  const loginForm = document.forms[`login`];\n  if (!loginForm) {\n    return;\n  }\n\n  const emailField = loginForm.querySelector(`[type=email]`);\n  const passwordField = loginForm.querySelector(`[type=password]`);\n\n  loginForm.addEventListener(`submit`, (evt) => {\n    evt.preventDefault();\n    cleanForm(loginForm);\n    setFormDisabled(loginForm, true);\n\n    fetch(`http://localhost:3000/api/login`, {\n      method: `POST`,\n      body: JSON.stringify({\n        email: emailField.value.trim(),\n        password: passwordField.value\n      }),\n      headers: new Headers({'Content-Type': `application/json`})\n    })\n      .then((res) => {\n        if (!res.ok) {\n          throw Error();\n        }\n      })\n      .then(() => location.reload(true))\n      .catch(() => {\n        loginForm.style.animation = `shake 0.6s`;\n        setFormDisabled(loginForm, false);\n      })\n  });\n})();\n\n//  sign-up\n'use strict';\n\n(function () {\n  const signUpForm = document.forms[`sign-up`];\n  if (!signUpForm) {\n    return;\n  }\n\n  const passwordField = signUpForm.querySelector(`[name=user-password]`);\n  const passwordAgainField = signUpForm.querySelector(`[name=user-password-again]`);\n  const avatarInput = signUpForm.querySelector(`[name=avatar]`);\n\n  signUpForm.addEventListener(`submit`, (evt) => {\n    evt.preventDefault();\n    cleanForm(signUpForm);\n\n    if (passwordField.value !== passwordAgainField.value) {\n      createPasswordError(signUpForm);\n      return;\n    }\n\n    const correctFileTypes = [`image/png`, `image/jpeg`];\n    if (!correctFileTypes.includes(avatarInput.files[0].type)) {\n      createAvatarError(signUpForm);\n      return;\n    }\n\n    const formData = new FormData(signUpForm);\n    setFormDisabled(signUpForm, true);\n\n    fetch(`http://localhost:3000/api/register`, {\n      method: `POST`,\n      body: formData\n    })\n      .then((res) => {\n        if (!res.ok) {\n          throw Error();\n        }\n      })\n      .then(() => location.assign(`/login`))\n      .catch(() => {\n        signUpForm.style.animation = `shake 0.6s`;\n        setFormDisabled(signUpForm, false);\n      })\n  });\n})();\n\n//  offer add\n'use strict';\n\n(function () {\n  const addForm = document.forms[`add`];\n  if (!addForm) {\n    return;\n  }\n\n  const avatarInput = addForm.querySelector(`[name=avatar]`);\n\n  addForm.addEventListener(`submit`, (evt) => {\n    evt.preventDefault();\n    cleanForm(addForm);\n\n    const correctFileTypes = [`image/png`, `image/jpeg`];\n    if (!correctFileTypes.includes(avatarInput.files[0].type)) {\n      createAvatarError(addForm);\n      return;\n    }\n\n    const selectedOptions = addForm.querySelectorAll(`[selected]`);\n    const categories = Array.prototype.map.call(selectedOptions, (option) => option.value);\n    const oldFormData = new FormData(addForm);\n    const formData = new FormData();\n    formData.append(`title`, oldFormData.get(`ticket-name`));\n    formData.append(`description`, oldFormData.get(`comment`));\n    formData.append(`type`, oldFormData.get(`action`));\n    formData.append(`sum`, oldFormData.get(`price`));\n    formData.append(`category`, categories);\n    formData.append(`avatar`, oldFormData.get(`avatar`))\n    setFormDisabled(addForm, true);\n\n    fetch(`http://localhost:3000/api/offers`, {\n      method: `POST`,\n      body: formData\n    })\n      .then((res) => {\n        if (!res.ok) {\n          throw Error();\n        }\n      })\n      .then(() => location.assign(`/my`))\n      .catch(() => {\n        addForm.style.animation = `shake 0.6s`;\n        setFormDisabled(addForm, false);\n      });\n  });\n})();\n\n//  offer edit\n'use strict';\n\n(function () {\n  const editForm = document.forms[`edit`];\n  if (!editForm) {\n    return;\n  }\n  editForm.querySelector(`[type=submit]`).removeAttribute(`disabled`);\n  const avatarInput = editForm.querySelector(`[name=avatar]`);\n\n  editForm.addEventListener(`submit`, (evt) => {\n    evt.preventDefault();\n    cleanForm(editForm);\n\n    const correctFileTypes = [`image/png`, `image/jpeg`];\n    if (avatarInput.files[0] && !correctFileTypes.includes(avatarInput.files[0].type)) {\n      createAvatarError(editForm);\n      return;\n    }\n\n    const oldFormData = new FormData(editForm);\n    const isAvatarChanged = avatarInput.files[0];\n    const selectedOptions = editForm.querySelectorAll(`[selected]`);\n    const categories = Array.prototype.map.call(selectedOptions, (option) => option.value);\n\n    const formData = new FormData();\n    formData.append(`title`, oldFormData.get(`ticket-name`));\n    formData.append(`description`, oldFormData.get(`comment`));\n    formData.append(`type`, oldFormData.get(`action`));\n    formData.append(`sum`, oldFormData.get(`price`));\n    formData.append(`category`, categories);\n    if (isAvatarChanged) {\n      formData.append(`avatar`, oldFormData.get(`avatar`))\n    }\n\n    setFormDisabled(editForm, true);\n    const offerId = editForm.dataset['offer'];\n    fetch(`http://localhost:3000/api/offers/${offerId}`, {\n      method: `PUT`,\n      body: formData\n    })\n      .then((res) => {\n        if (!res.ok) {\n          throw Error();\n        }\n      })\n      .then(() => location.assign(`/my`))\n      .catch(() => {\n        editForm.style.animation = `shake 0.6s`;\n        setFormDisabled(editForm, false);\n      });\n  });\n})();\n\n//  helpers\n'use strict';\n\n(function () {\n  window.setFormDisabled = (form, status) => {\n    const inputs = form.querySelectorAll(`input`);\n    const textArea = form.querySelector(`textarea`);\n    const select = form.querySelector(`select`);\n\n    if (status) {\n      form.setAttribute(`disabled`, `disabled`);\n    } else {\n      form.removeAttribute(`disabled`);\n    }\n\n    if (textArea && status) {\n      textArea.setAttribute(`disabled`, `disabled`);\n    } else if (textArea && !status) {\n      textArea.removeAttribute(`disabled`);\n    }\n\n    if (select && status) {\n      select.setAttribute(`disabled`, `disabled`);\n    } else if (select && !status) {\n      select.removeAttribute(`disabled`);\n    }\n\n    if (inputs.length) {\n      inputs.forEach((input) => {\n        if (status) {\n          input.setAttribute(`disabled`, `disabled`);\n        } else {\n          input.removeAttribute(`disabled`);\n        }\n      })\n    }\n  };\n\n  window.createPasswordError = (form) => {\n    const errorMessage = document.createElement(`p`);\n    errorMessage.classList.add(`text`, `text--error`);\n    errorMessage.innerText = `Пароли должны совпадать`;\n    form.querySelectorAll(`[type=password]`).forEach((input) => {\n      input.parentElement.classList.add(`field--error`);\n    });\n    form.insertBefore(errorMessage, form.lastElementChild);\n  };\n\n  window.createAvatarError = (form) => {\n    const errorMessage = document.createElement(`p`);\n    errorMessage.classList.add(`text`, `text--error`);\n    errorMessage.innerText = `Допустимые расширения файла .jpeg, .jpg, .png`;\n    form.insertBefore(errorMessage, form.querySelector(`[type=file]`).parentElement.parentElement);\n  };\n\n  window.cleanForm = (form) => {\n    form.style.animation = ``;\n    form\n      .querySelectorAll(`.text--error`)\n      .forEach((message) => form.removeChild(message));\n    form\n      .querySelectorAll(`input`)\n      .forEach((input) => input.parentElement.classList.remove(`field--error`));\n  };\n})();\n\n//# sourceMappingURL=main.js.map\n"],"file":"main.js"}